<!-- <div class="modal on" >
    
</div> -->
<style>
    #module-pembayaran .progress-bar{
        display: flex;
        width: 100%;
    }
    #module-pembayaran .progress-bar .wrapper{
        display: block;
        width: 100%;
        height: 2rem;
        padding: 0.5rem;
        background-color: var(--background-color-button-light);
        border-radius: 1rem;
        overflow: hidden;
    }
    #module-pembayaran .progress-bar .wrapper .fill{
        background-color: var(--background-color-button);
        width: var(--progress-fill);
        border-radius: 1rem;
        min-width: 0%;
        max-width: 100%;
        height: 100%;
        animation: flashing 1s infinite;
    }
    @keyframes flashing {
        0%{
            filter: brightness(0.5);
        }
        100%{
            filter: brightness(1);
        }
    }

    .module-pembayaran-listing .peserta{
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
    }
    .module-pembayaran-listing .peserta-status-1{
        background-color: red;
    }
    .module-pembayaran-listing .peserta-status-2{
        background-color: rgb(255,90,0);
    }
    .module-pembayaran-listing .peserta-status-3{
        background-color: rgb(0,170,118);
    }
</style>
<div class="container" id="module-pembayaran"><br>
    <h2 class="wide"><i class="fas fa-badge-check"></i>&nbsp;Info Pembayaran</h2>
    <h1><span class="payment-progress-percent">.......</span></h1>
    <h4><span class="payment-current">.....</span></h4>
    <div class="progress-bar">
        <div class="wrapper">
            <div class="fill payment-progress" style="--progress-fill: 0%;"></div>
        </div>
    </div>
    <p class="payment-pesan">.......</p><br>
    <h2 class="wide"><i class="fas fa-users"></i>&nbsp;Peserta Kelas</h2>
    <div class="container swiper module-pembayaran-listing round">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                
            </div>
        </div>
    </div>
</div>
<script>
    
    function modulePembayaranSingle() {
        // Load data pembayaran
        let procOncePembayaranSingle = setInterval(() => {
            let data = appData.pembayaran;

            // Format rupiah
            const rupiah = (number)=>{
                return new Intl.NumberFormat("id-ID", {
                style: "currency",
                currency: "IDR"
                }).format(number);
            }

            if (data != []){
                let payCurrent = 0;
                let payPercent = 0;
                let payProg = 0;
                let payPesan = `Pembayaran GTC anda belum lunas..<br>ğŸ’ªğŸ’ªâœŠï¸`;
                let payInstallments = 0;

                // Load masing-masing data pembayaran dan akumulasikan
                $.each(data, function( i, v ) {
                    payCurrent += parseInt(v.jumlah_setor);
                    payInstallments ++;
                }); 

                // Kalkulasi progress
                payProg = (payCurrent / 3750000);
                // Dibuat persentase
                payPercent = String(Math.floor(payProg*100));
                // Jika sudah lunas
                switch (payProg) {
                    case 1:
                        payPercent = 'Lunas ' + payPercent;
                        payPesan = `Anda sudah melunasi pembayaran GTC.<br>ğŸ¤ğŸ‘ğŸ»ğŸ‘`;
                        sudahBayar(payCurrent, payPercent, payPesan, payInstallments);
                        break;
                    case 0:
                        belumBayar();
                        break;
                    default:
                        sudahBayar(payCurrent, payPercent, payPesan, payInstallments);
                        break;
                }
                
            }else{
                belumBayar();
            }

            function belumBayar() {
                $(".payment-current").text('Data pemasukan tidak ditemukan.');
                $(".payment-progress-percent").text('Belum Bayar');
                $(".payment-progress").css('--progress-fill','5%');
                $(".payment-pesan").html(`
                    Berdasarkan data dari Travel, Anda belum melakukan pembayaran GTC..<br>ğŸ’ªğŸ’ªğŸ’ª
                `);
            }

            function sudahBayar(p1, p2, p3, p4) {
                $(".payment-current").text(`${rupiah(p1)} (${p4}x)`);
                $(".payment-progress-percent").text(`${p2}%`);
                $(".payment-progress").css('--progress-fill',`${p2}%`);
                $(".payment-pesan").html(p3);
            }

            if (appAccount.role == 'guru'){
                // ${rupiah(3750000)}
                $(".payment-current").text(``);
                $(".payment-progress-percent").text(`Tidak Ada Pembayaran`);
                $(".payment-progress").css('--progress-fill',`100%`);
                $(".payment-pesan").html(`Semoga GTC 2023 berjalan dengan lancar dan selamat hingga kembali ke tangerang ğŸ¤²`);
            }

            // Done loading Thumbnail
            clearInterval(procOncePembayaranSingle);
        }, 1000);
    }
    modulePembayaranSingle();

    function modulePembayaranListing() {

        // Init Listing Pembayaran
        let modulePembayaranListing = new Swiper('.module-pembayaran-listing', {
            slidesPerView: 'auto',
            spaceBetween: 14,
            autoplay: {
                delay: 4000,
                disableOnInteraction: false,
            }, loop: true
        });

        // Load data pembayaran listing
        let procOncePembayaranListing = setInterval(() => {

            let data = appData.pembayaranlisting;
            let setoran = {};

            if (data != []){

                // Load masing-masing data pembayaran dan akumulasikan
                $.each(data, function( i, v ) {

                    if (setoran[v.kode_akun] == null){
                        setoran[v.kode_akun] = {nama : '', current : 0, lunas:1};
                    }
                    setoran[v.kode_akun].nama = v.nama
                    setoran[v.kode_akun].current += parseInt(v.jumlah_setor);
                    
                    if (setoran[v.kode_akun].current > 0){
                        setoran[v.kode_akun].lunas = 2;
                    }
                    if (setoran[v.kode_akun].current == 3750000){
                        setoran[v.kode_akun].lunas = 3;
                    }

                }); 
                let target = modulePembayaranListing;
                let ohtml = ``; let count = 0;
                $.each(setoran, function( i, v ) {
                    if (count == 0){
                        ohtml += `<div class="swiper-slide">`;
                    }
                    ohtml += `
                        <p class="peserta peserta-status-${v.lunas}">${v.nama}</p>
                    `;
                    count ++;
                    if (count == 5){
                        ohtml += `</div>`;
                        count = 0;
                    }
                }); 
                console.log(ohtml);
                // Menghapus isi slide yang ada dan timpa html dengan yang baru dari urlSource
                target.removeAllSlides();
                target.appendSlide(ohtml);
            }

            // Done loading data
            clearInterval(procOncePembayaranListing);
        }, 1000);
    }
    modulePembayaranListing();
</script>